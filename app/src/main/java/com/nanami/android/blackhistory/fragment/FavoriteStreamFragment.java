package com.nanami.android.blackhistory.fragment;import android.os.AsyncTask;import android.os.Bundle;import com.nanami.android.blackhistory.adapter.TweetAdapter;import com.nanami.android.blackhistory.event.EventBusHolder;import com.nanami.android.blackhistory.event.TwitterFavoriteEvent;import com.nanami.android.blackhistory.event.TwitterStreamEvent;import com.nanami.android.blackhistory.fragment.list.TimelineListType;import com.nanami.android.blackhistory.utils.BHLogger;import com.squareup.otto.Subscribe;import java.util.List;import twitter4j.Status;import twitter4j.Twitter;import twitter4j.TwitterException;/** * Created by TEJNEK on 2016/01/19. */public class FavoriteStreamFragment extends CommonStreamFragment {    public static FavoriteStreamFragment newInstance(Long userId, TimelineListType listType){        FavoriteStreamFragment fragment = new FavoriteStreamFragment();        Bundle bundle = new Bundle();        bundle.putLong(fragment.ARGS_USER_ID, userId);        bundle.putInt(fragment.ARGS_LIST_TYPE, listType.getIndex());        fragment.setArguments(bundle);        return fragment;    }    @Override    public void onResume() {        super.onResume();        EventBusHolder.EVENT_BUS.register(this);    }    @Override    public void onPause() {        EventBusHolder.EVENT_BUS.unregister(this);        super.onPause();    }    @Override    public void reloadTimeLine() {        AsyncTask<Void, Void, List<Status>> task = new AsyncTask<Void, Void, List<twitter4j.Status>>() {            @Override            protected List<twitter4j.Status> doInBackground(Void... params) {                try {                    return getTwitter().getFavorites();                } catch (TwitterException e) {                    e.printStackTrace();                }                return null;            }            @Override            protected void onPostExecute(List<twitter4j.Status> result) {                if (result != null) {                    getAdapter().clear();                    getAdapter().addAll(result);                    getListView().setSelection(0);                } else {                    BHLogger.toast("タイムラインの取得に失敗しました。");                }            }        };        task.execute();    }    @Subscribe    public void OnTwitterStreamEvent(TwitterFavoriteEvent event){        if(event.getUserId() != getUserId()) return;        final Status status = event.getFavoritedStatus();        try {            getActivity().runOnUiThread(new Runnable() {                @Override                public void run() {                    refreshView(status);                }            });        } catch (Exception e) {            System.out.println(e.toString());        }    }}